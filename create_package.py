#!/usr/bin/env python3
"""
–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è Secure Messenger
"""

import os
import shutil
import zipfile
from pathlib import Path

def create_distribution_package():
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è"""
    
    print("üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è...")
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –ø–∞–∫–µ—Ç–∞
    package_dir = Path("SecureMessenger_Package")
    if package_dir.exists():
        shutil.rmtree(package_dir)
    package_dir.mkdir()
    
    # –§–∞–π–ª—ã –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø–∞–∫–µ—Ç
    files_to_copy = [
        "server.py",
        "client.py", 
        "database.py",
        "crypto_utils.py",
        "simple_web_server.py",
        "index.html",
        "start_messenger.py",
        "get_ip.py",
        "requirements.txt",
        "README.md",
        "DEPLOYMENT_GUIDE.md",
        "run_server.bat",
        "run_client.bat",
        "run_web.bat"
    ]
    
    # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã
    for file in files_to_copy:
        if os.path.exists(file):
            shutil.copy2(file, package_dir)
            print(f"‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: {file}")
        else:
            print(f"‚ö†Ô∏è  –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {file}")
    
    # –°–æ–∑–¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    user_guide = package_dir / "–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–î–õ–Ø_–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô.txt"
    with open(user_guide, 'w', encoding='utf-8') as f:
        f.write("""
üîê SECURE MESSENGER - –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô

üìã –ß–¢–û –í –ü–ê–ö–ï–¢–ï:
- Secure Messenger - –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
- 3 —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã: –¥–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è, –≤–µ–±-–≤–µ—Ä—Å–∏—è, –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —á–∞—Ç—ã
- End-to-end —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

üöÄ –ë–´–°–¢–†–´–ô –ó–ê–ü–£–°–ö:

1. –£–°–¢–ê–ù–û–í–ò–¢–ï PYTHON (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):
   - –°–∫–∞—á–∞–π—Ç–µ —Å https://python.org
   - –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–º–µ—Ç—å—Ç–µ "Add Python to PATH"

2. –£–°–¢–ê–ù–û–í–ò–¢–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò:
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ –ø–∞–ø–∫–µ —Å —Ñ–∞–π–ª–∞–º–∏
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ: pip install -r requirements.txt

3. –ó–ê–ü–£–°–¢–ò–¢–ï –ú–ï–°–°–ï–ù–î–ñ–ï–†:
   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞: start_messenger.py
   - –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ: python start_messenger.py

üì± –†–ï–ñ–ò–ú–´ –†–ê–ë–û–¢–´:

üñ•Ô∏è –î–ï–°–ö–¢–û–ü–ù–ê–Ø –í–ï–†–°–ò–Ø:
- –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–∫ –≤ Telegram
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- –û–±—ã—á–Ω—ã–µ —á–∞—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è

üåê –í–ï–ë-–í–ï–†–°–ò–Ø:
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏

üõ°Ô∏è –ó–ê–©–ò–©–ï–ù–ù–´–ï –ß–ê–¢–´:
- End-to-end —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
- –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞ (–∫–ª—é—á —á–∞—Ç–∞ + –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è)
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

üîß –†–£–ß–ù–û–ô –ó–ê–ü–£–°–ö:

–°–ï–†–í–ï–†:
- python server.py
- –ò–ª–∏ –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞: run_server.bat

–ö–õ–ò–ï–ù–¢:
- python client.py  
- –ò–ª–∏ –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞: run_client.bat

–í–ï–ë-–í–ï–†–°–ò–Ø:
- python simple_web_server.py
- –ò–ª–∏ –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞: run_web.bat
- –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:8080

üåç –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –° –î–†–£–ó–¨–Ø–ú–ò:

1. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à IP –∞–¥—Ä–µ—Å:
   - python get_ip.py

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:
   - python simple_web_server.py

3. –î—Ä—É–∑—å—è –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É:
   - http://–í–ê–®_IP:8080

4. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:
   - –°–∫–∞—á–∞–π—Ç–µ ngrok —Å https://ngrok.com
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ngrok http 8080
   - –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–æ–π

üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å —Å–æ–ª—å—é (PBKDF2)
- –°–æ–æ–±—â–µ–Ω–∏—è —à–∏—Ñ—Ä—É—é—Ç—Å—è AES-256
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —á–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π

‚ùì –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú:

–ü—Ä–æ–±–ª–µ–º–∞: "–ú–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"
–†–µ—à–µ–Ω–∏–µ: pip install -r requirements.txt

–ü—Ä–æ–±–ª–µ–º–∞: "–ü–æ—Ä—Ç –∑–∞–Ω—è—Ç"  
–†–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç

–ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è"
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä –∏ IP –∞–¥—Ä–µ—Å

üìû –ü–û–î–î–ï–†–ñ–ö–ê:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ README.md –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DEPLOYMENT_GUIDE.md –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Python 3.8+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

üéâ –£–î–ê–ß–ù–û–ì–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø!
""")
    
    print(f"‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: {user_guide}")
    
    # –°–æ–∑–¥–∞–µ–º ZIP –∞—Ä—Ö–∏–≤
    zip_path = "SecureMessenger_For_Friends.zip"
    with zipfile.ZipFile(zip_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
        for root, dirs, files in os.walk(package_dir):
            for file in files:
                file_path = os.path.join(root, file)
                arcname = os.path.relpath(file_path, package_dir)
                zipf.write(file_path, arcname)
                print(f"üì¶ –î–æ–±–∞–≤–ª–µ–Ω –≤ –∞—Ä—Ö–∏–≤: {arcname}")
    
    print(f"\nüéâ –ü–ê–ö–ï–¢ –°–û–ó–î–ê–ù: {zip_path}")
    print(f"üìÅ –†–∞–∑–º–µ—Ä: {os.path.getsize(zip_path) / 1024 / 1024:.1f} MB")
    print(f"üì§ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –¥—Ä—É–∑—å—è–º!")
    
    # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
    shutil.rmtree(package_dir)
    print("üßπ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã")

if __name__ == "__main__":
    create_distribution_package()
    input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞...")

